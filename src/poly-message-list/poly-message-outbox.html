<link rel="import" href="../../bower_components/iron-list/iron-list.html">
<link rel="import" href="../../bower_components/polymer-redux/polymer-redux.html">
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="poly-message-actions.html"> 
<link rel="import" href="poly-message-list-item.html"> 
<link rel="import" href="poly-message-list-toolbar.html"> 

<dom-module id="poly-message-outbox">
  <template>

    <style>

      :host {
        display: block;
        height: calc(100vh - 115px);
        width: 100vw;
        display: flex;
        flex-direction: column;
      }

      iron-pages {
        display: block;
        height: 100%;
        width: 100%;
        display: flex;
        flex-direction: column;
      }

      iron-list {
        flex: 1 1 auto;
        padding-top: 32px;
        padding-bottom: 32px;
      }

      .list-item {
        height: 170px;
        width: 290px;
      }

    </style>

    <poly-message-actions id="actions"></poly-message-actions>

    <poly-message-list-toolbar 
      on-select-all   = "handleSelectAll"
      on-unselect-all = "handleUnselectAll"
      has-selection   = "[[hasSelection]]">
    </poly-message-list-toolbar>

    <iron-list
      id             = "message-list"
      items          = "[[items]]"
      selected-items = "{{listSelectedItems}}"
      selection-enabled 
      multi-selection>

      <template>
        <div class="list-item">
          <poly-message-list-item 
            item               = "[[item]]"
            index              = "[[index]]"
            selected           = "[[selected]]"
            on-actions-tap     = "showActions"
            on-toggle-selected = "handleToggleSelected">
          </poly-message-list-item>
        </div>
      </template>

    </iron-list>

    <content></content>

  </template>

  <script>
    Polymer({

      is: 'poly-message-outbox',

      properties: {
        items: {
          type: Array,
          statePath: 'messages.outbox',
        },
        listSelectedItems: {
          type: Object,
        },
        hasSelection: {
          type: Boolean,
          value: false,
        },
      },

      observers: [
        'selectedItemsChanged(listSelectedItems.*)',
      ],

      selectedItemsChanged: function() {
        this.hasSelection = (this.listSelectedItems.length > 0);
      },

      handleToggleSelected: function(event) {
        this.$['message-list'].toggleSelectionForItem(event.model.item);
      },

      handleSelectAll: function() {
        var list = this.$['message-list'];
        for (var i = 0; i < this.items.length; i++) {
          list.selectItem(i);
        }
      },

      handleUnselectAll: function() {
        this.$['message-list'].clearSelection();
      },

      showActions: function(event) {
        var body = document.querySelector('body');
        Polymer.dom(body).appendChild(this.$.actions);
        this.$.actions.open();
      },

      behaviors: [
      ],

    });
  </script>
</dom-module>
