<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-icons/device-icons.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-item/paper-icon-item.html">
<link rel="import" href="../../bower_components/paper-slider/paper-slider.html">
<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="poly-channel">
  <template>
    <style include="iron-flex">

      :host {
        margin-top: 10px;
        display: flex;
      }

      .header {
        @apply(--layout-horizontal);
        justify-content: space-between; 
        margin-bottom: 12px; 
        align-items: center;
      }

      .controls {
        @apply(--layout-horizontal);
        border-top: 1px solid #e8e8e8;
      }

      .label {
        margin-right: 12px; 
        width: 80px;
      }

      .provider {
        margin-right: 12px; 
        color: #737373;
      }

      .network-mode {
        background: grey; 
        color: white; 
        display: flex; 
        margin: 0 0 0 16px; 
        padding: 0 6px;
        justify-content: center; 
        align-items: center; 
        font-size: 12px; 
        font-weight: bold;
      }

      .avatar {
        display: flex;
        justify-content: center;
        align-items: center;
        box-sizing: border-box;
        width: 40px;
        height: 40px;
          /*
        border-radius: 50%;
        color: gray;
        background: rgb(255, 64, 129); 
        color: white;
          */
      }

      .avatar-free {
        /*
        background: rgb(0, 188, 212);
          */
        color: rgb(0, 188, 212);
      }

      .avatar-defunct {
        /*
        background: gray;
          */
        color: gray;
      }

      .slider {
        @apply(--layout-horizontal);
        align-items: center;
      }

      paper-slider {
        width: 100%;
        --paper-slider-active-color: rgb(0, 188, 212);
        --paper-slider-knob-color: rgb(0, 188, 212);
        --paper-slider-pin-color: rgb(0, 188, 212);
        --paper-slider-secondary-color: rgb(0, 188, 212);
      }

      paper-button {
        color: rgb(0, 188, 212);
      }

      paper-icon-item {
        --paper-item-selected: {
          background: red;
        };
      }

      paper-card {
        margin: 0 auto;
        width: 800px;
      }

    </style>

    <paper-card>

      <div class="card-content">

        <div class="header">

          <div style="flex-grow: 1;">
            {{channelId}}
          </div>
        
          <div class="label">
            {{label}} 
          </div>

          <div class="provider">
            {{provider}} 
          </div>

          <iron-icon icon="[[_signalStrengthIcon(rssi)]]"></iron-icon>

          <div class="network-mode">[[_networkMode(networkMode)]]</div>

        </div>

        <div class="controls">

          <paper-icon-item style="width: 160px; padding: 0;">
            <div class$="avatar [[_avatarClass(mode)]]" item-icon>
              <iron-icon icon="[[_avatarIcon(mode)]]" item-icon></iron-icon>
            </div>
            <paper-item-body two-line>
              <div>[[_displayName(name, channelId, number)]]</div>
              <div secondary>[[_displayNumber(number, mode)]]</div>
            </paper-item-body>
          </paper-icon-item>

          <template is="dom-if" if="[[_controlsVisible(mode)]]">

            <div class="slider" style="width: 100%; margin-left: 32px;">

              [[mode]]

              <div style="flex: 1; display: flex; flex-direction: row;">
                <paper-icon-button active="true" toggles="true" icon="av:volume-up" style="color: gray;"></paper-icon-button>
                <paper-slider value="[[level]]" pin></paper-slider>
              </div>

              <div style="align-self: center;">
                <div style="display: flex; justify-content: flex-end;">
                  <paper-button>Private</paper-button>
                  <paper-button>Hold</paper-button>
                  <paper-button>Hang up</paper-button>
                </div>
              </div>

            </div>

          </template>

        </div>

      </div>

    </paper-card>

  </template>

  <script>
    Polymer({

      is: 'poly-channel',

      properties: {
        mode: {
          type: String,
        },
        level: {
          type: Number,
        },
        rssi: {
          type: String,
        },
        channelId: {
          type: String,
        },
        label: {
          type: String,
        },
        provider: {
          type: String,
        },
        networkMode: {
          type: String,
        },
        contact: {
          type: Object,
        },
        name: {
          type: String,
        },
        number: {
          type: String,
        },
      },

      observers: [
        '_contactChanged(contact.*)'
      ],

      _signalStrengthIcon(rssi) {
        var s = parseInt(rssi.split(',')[0]);
        if (s) {
          var quality = Math.min(4, Math.floor(s/6));
          return 'device:signal-cellular-' + quality + '-bar';
        }
      },

      _avatarClass: function(mode) {
        return 'avatar-' + mode;
      },

      _avatarIcon: function(mode) {
        switch (mode) {
          case 'defunct':
            return 'block';
          case 'free':
          default:
            return 'communication:phone';
        }
      },

      _displayName: function(name, chan, number) {
        if (name === chan)
          return number ? 'Last call' : '';
        else
          return name;
      },

      _displayNumber: function(number, mode) {
        return number;
      },

      _controlsVisible: function(mode) {
        return mode != 'defunct';
      },

      _networkMode: function(mode) {
        switch (mode) {
          case 'GSM/GPRS':
            return '2G';
        }
        return '';
      },

      _contactChanged: function(data) {
        console.log('_contactChanged');
        var contact = data.value;
        if (contact) {
          this.name = contact.name;
          this.number = contact.number;
        }
      },

    });
  </script>
</dom-module>
