<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="poly-message-hander">
  <template></template>

  <script>
    Polymer({

      is: 'poly-message-handler',

      ready: function() {
        window.__socket__ = new WebSocket('ws://192.168.1.7:19998'); // thehangar.farmradio.org:51234
//        window.__socket__ = new WebSocket('ws://thehangar.farmradio.org:51234');
        window.__socket__.onerror   = this.onError.bind(this);
        window.__socket__.onopen    = this.onOpen.bind(this);
        window.__socket__.onclose   = this.onClose.bind(this);
        window.__socket__.onmessage = this.onMessage.bind(this);
      },

      onError: function(event) {
        this.fire('error');
      },

      onOpen: function(event) {
        this.fire('open');
      },

      onClose: function(event) {
        this.fire('close');
      },

      onMessage: function(event) {
        var response = null;
        try {
          response = JSON.parse(event.data);
        } catch(e) {
          console.error(e);
          return;
        }
        this.fire('message', response);
      },

      send: function(data) {
        window.__socket__.send(JSON.stringify(data));
      },

    });
  </script>
</dom-module>
